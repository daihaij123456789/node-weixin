"use strict";$.support.cors=!0,$(function(){function t(t){return t<10?"0"+t:""+t}function e(e){return t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())}var a=15*Math.ceil($(".rating-num strong").html()-10);$(".star").css("background-position-y",a),$("#mediaList").on("click",".comment",function(){var t=$(this),e=t.data("tid"),a=t.data("cid");$(t).parents(".media-body").attr("id","mediaBody"),$("#toId").length>0?$("#toId").val(e):$("<input>").attr({type:"hidden",id:"toId",name:"comment[tid]",value:e}).appendTo("#commentForm"),$("#commentId").length>0?$("#commentId").val(a):$("<input>").attr({type:"hidden",id:"commentId",name:"comment[cid]",value:a}).appendTo("#commentForm")}),$("#comments button").on("click",function(t){t.preventDefault(),$.ajax({url:"/admin/music/musicComment",type:"POST",data:{"comment[music]":$('#comments input[name="comment[music]"]').val(),"comment[from]":$('#comments input[name="comment[from]"]').val(),"comment[content]":$("#comments textarea").val(),"comment[tid]":$("#toId").val(),"comment[cid]":$("#commentId").val()}}).done(function(t){var a=t.data||{};if(a.reply.length){var n=a.reply.length;$("#mediaBody").append('<div class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 30px; height: 30px;"/></div><div class="media-body"><h4  class="media-heading">'+a.reply[n-1].from.name+"<span>&nbsp;回复&nbsp;</span>"+a.reply[n-1].to.name+"</h4><p>"+a.reply[n-1].content+'</p><span class="createAt">'+e(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.reply[n-1].to._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+a._id+" data-did="+a.reply[n-1]._id+">删除</a></div></div>")}else $("#mediaList").append('<li class="media"><div class="media-left"><img src="/libs/images/user/headImg.png" style="width: 40px; height: 40px;" /></div><div class="media-body"><h4 class="media-heading">'+a.from.name+"</h4><p>"+a.content+'</p><span class="createAt">'+e(new Date)+'</span>&nbsp;&nbsp;&nbsp;&nbsp;<a class="comment" href="#comments" data-cid='+a._id+" data-tid="+a.from._id+'> 回复</a>&nbsp;|&nbsp;<a class="comment-del" href="javascript:;" data-cid='+a._id+">删除</a></div><hr></li>");$("#comments textarea").val(""),$("#mediaBody").removeAttr("id"),$("#commentForm input:gt(1)").remove()})}),$("#mediaList").on("click",".comment-del",function(t){var e=$(this).parent(".media-body"),a=$(t.target).data("cid"),n=$(t.target).data("did");$.ajax({url:"/music/:id?cid="+a+"&did="+n,type:"DELETE"}).done(function(t){1===t.success&&e.parent().remove()})}),$("audio")[0].volume=.2,$("audio").on("play",function(t){var e=($(this),0),a=[],n=[],i=((new Date).getTime(),$("#lrc")),s=$(".aplayer-lrc-content").html(),c=s.split(/\n/),d=/\[(\d{2}):(\d{2})\.(\d{3})]/,m=/](.*)$/,r=/\[[A-Za-z]+:/,o='<div class="lyrics-container">';o+='<div class="lyrics-container2">';for(var l=0;l<c.length;l++){c[l]=c[l].replace(/^\s+|\s+$/g,"");var p=d.exec(c[l]),h=m.exec(c[l]);if(p&&h&&!m.exec(h[1]))a.push(60*parseInt(p[1])+parseInt(p[2])+parseInt(p[3])/1e3),n.push(h[1]);else if(c[l]&&!r.exec(c[l]))throw"APlayer Error: lrc format error : should be like `[mm:ss.xx]lyric` : "+c[l]}for(l=0;l<n.length;l++)o+="<p name="+l+' class="lyrics" tag='+a[l]+">"+n[l]+"</p>";o+="</div></div>",i.html(o);var u=i.find(".lyrics").last(),v=setInterval(function(){if(!t){var t=$("audio")[0].currentTime;(t<a[e]||t>=a[e+1])&&i.find(".lyrics").each(function(a,n){if(t>=$(this).attr("tag")&&(!$(this).next().attr("tag")||t<$(this).next().attr("tag"))){if(e=a,$(this).addClass("activated").siblings(".lyrics").removeClass("activated"),$(this).prevAll(".lyrics").length>4){var i=-30*($(this).attr("name")-3)+"px";$(".lyrics-container2").css({top:i})}if($(this).attr("name")===u.attr("name")){setTimeout(function(){$(".lyrics-container2").css({top:0})},1e4)}}})}},1e3);i.find(".lyrics").attr("name")===u.attr("name")&&clearInterval(v)})});